<!--
  ~ Copyright 2019 HERMENEUT Consortium
  ~  
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~  
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~  
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  -->
<ng-container *ngIf="isLoading">
    <div class="loader"></div>
</ng-container>
<ng-container *ngIf="!isLoading">
    <mat-accordion>
        <mat-expansion-panel [expanded]="true">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <h2>
                        <a href="javascript:void(0);" class="collapse-link">Vulnerability Assessment</a>
                    </h2>
                </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="table-responsive">
                <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 15%">Steps</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th style="width: 7%" class="text-center">Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Identify Threat Agents</td>
                        <td>Aims at identifying who may be interested in performing the attack against the company and
                            why,
                            using as a base what emerged from asset clustering. This phase responds to the questions:
                            “Who
                            would attack my company?” and “Why somebody should attack my company?”
                        </td>
                        <td class="text-center">
                            <i *ngIf="identifyThreatAgentsStatus === statusEnum.FULL" style="color: green"
                               class="fa fa-check"
                               aria-hidden="true"
                               [ngbTooltip]="statusEnum[identifyThreatAgentsStatus][0] + statusEnum[identifyThreatAgentsStatus].substr(1).toLowerCase()"></i>
                            <i *ngIf="identifyThreatAgentsStatus === statusEnum.EMPTY || identifyThreatAgentsStatus === statusEnum.PENDING"
                               style="color: orange" class="fa fa-exclamation-triangle" aria-hidden="true"
                               [ngbTooltip]="statusEnum[identifyThreatAgentsStatus][0] + statusEnum[identifyThreatAgentsStatus].substr(1).toLowerCase()"></i>
                        </td>
                        <td class="text-center">
                            <a *ngIf="identifyThreatAgentsStatus === statusEnum.EMPTY"
                               [routerLink]="['/identify-threat-agent/questionnaires/ID_THREAT_AGENT']"><i
                                class="fa fa-plus-square fa-lg"
                                placement="top"
                                aria-hidden="true"></i></a>
                            <ng-container
                                *ngIf="identifyThreatAgentsStatus === statusEnum.PENDING || identifyThreatAgentsStatus === statusEnum.FULL">
                                <a href="javascript:void(0)"
                                   (click)="open(alert,'/identify-threat-agent/questionnaires/ID_THREAT_AGENT')"><i
                                    placement="top" class="fa fa-pencil-square-o fa-lg"
                                    aria-hidden="true"></i></a>
                            </ng-container>
                        </td>
                    </tr>
                    <tr>
                        <td>Assess Vulnerablities</td>
                        <td>
                            <p>
                                Measures the weak points of company surface through self-assessment (cyber maturity
                                questionnaire). It
                                responds to the question: “Which are the weaknesses of my company?”
                            </p>
                            <jhi-vulnerability-assessment-selector *ngIf="questionnaireStatuses && questionnaireStatuses.length"
                                                                   [questionnaireStatuses]="questionnaireStatuses"></jhi-vulnerability-assessment-selector>
                        </td>
                        <td class="text-center">
                            <i *ngIf="assessVulnerabilitiesStatus === statusEnum.FULL" style="color: green"
                               class="fa fa-check"
                               aria-hidden="true"
                               [ngbTooltip]="statusEnum[assessVulnerabilitiesStatus][0] + statusEnum[assessVulnerabilitiesStatus].substr(1).toLowerCase()"></i>
                            <i *ngIf="assessVulnerabilitiesStatus === statusEnum.EMPTY || assessVulnerabilitiesStatus === statusEnum.PENDING"
                               style="color: orange" class="fa fa-exclamation-triangle" aria-hidden="true"
                               [ngbTooltip]="statusEnum[assessVulnerabilitiesStatus][0] + statusEnum[assessVulnerabilitiesStatus].substr(1).toLowerCase()"></i>
                            <div *ngIf="assessVulnerabilitiesCompletion && questionnaireStatuses && questionnaireStatuses.length">
                                <p>Completion</p>
                                <table>
                                    <thead>
                                    <th class="small text-muted pr-2" scope="row">Human</th>
                                    <th class="small text-muted pr-2" scope="row">IT</th>
                                    <th class="small text-muted pr-2" scope="row">Physical</th>
                                    </thead>
                                    <tbody>
                                    <td>{{assessVulnerabilitiesCompletion.human | percent}}</td>
                                    <td>{{assessVulnerabilitiesCompletion.it | percent}}</td>
                                    <td>{{assessVulnerabilitiesCompletion.physical | percent}}</td>
                                    </tbody>
                                </table>
                            </div>
                        </td>
                        <td class="text-center">
                            <a *ngIf="assessVulnerabilitiesStatus === statusEnum.EMPTY"
                               [routerLink]="['/evaluate-weakness/questionnaires/SELFASSESSMENT']"><i
                                class="fa fa-plus-square fa-lg"
                                placement="top"
                                aria-hidden="true"></i></a>
                            <ng-container
                                *ngIf="assessVulnerabilitiesStatus === statusEnum.PENDING || assessVulnerabilitiesStatus=== statusEnum.FULL">
                                <a href="javascript:void(0)"
                                   (click)="open(alert,'/evaluate-weakness/questionnaires/SELFASSESSMENT')"><i
                                    placement="top" class="fa fa-pencil-square-o fa-lg"
                                    aria-hidden="true"></i></a>
                            </ng-container>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <ng-template #alert let-d="dismiss" let-c="close">
                    <div class="modal-header">
                        <h4 class="modal-title" id="modal-basic-title">Edit notification</h4>
                        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <ng-container *ngIf="">
                            {{alertMessage}}
                        </ng-container>
                        <ng-container *ngIf="!alertMessage">
                            <p>Editing such step may influence the entire assessment.</p>
                            <p>If you want to proceed, just click on "OK" and edit your preferences, otherwise, you can
                                just
                                proceed in "view" mode without making any changes.</p>
                            <p>Do you want to proceed?</p>
                        </ng-container>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-dark" (click)="c('Save click')">OK</button>
                    </div>
                </ng-template>
            </div>
        </mat-expansion-panel>
    </mat-accordion>
</ng-container>
