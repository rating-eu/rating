<ng-container>
    <mat-accordion>
        <mat-expansion-panel>
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <h2>
                        <a href="javascript:void(0);" class="collapse-link">Assessment Area</a>
                        <span class="badge badge-pill badge-secondary">Based on a 1 to 5 scale</span>
                    </h2>
                </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="row mb-3">
                <div class="col-md-6 text-center">
                    <h5>Overall Vulnerabilities</h5>
                    <div *ngIf="overallRadarChartDataSets && overallRadarChartDataSets.length"
                         style="display: block; position: relative; height: 30vh;">
                        <canvas baseChart
                                [datasets]="overallRadarChartDataSets"
                                [options]="overallRadarChartOptions"
                                [labels]="radarChartLabels"
                                [colors]="[
                                    {
                                       backgroundColor: 'rgba(159, 90, 253, 0.3)',
                                       borderColor: 'rgba(159, 90, 253, 1)'
                                    }
                                ]"
                                [chartType]="radarChartType">
                        </canvas>
                    </div>
                </div>
                <div class="col-md-6 text-center">
                    <h5>Area Vulnerabilities</h5>
                    <div *ngIf="radarChartDataSets && radarChartDataSets.length"
                         style="display: block; position: relative; height: 30vh;">
                        <canvas baseChart
                                [datasets]="radarChartDataSets"
                                [options]="radarChartOptions"
                                [labels]="radarChartLabels"
                                [chartType]="radarChartType">
                        </canvas>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div *ngIf="vulnerabilityAreas && containerTypes && data" class="table-responsive">
                        <table class="table table-striped">
                            <thead class="thead-light">
                            <tr>
                                <th class="text-center"></th>
                                <th class="text-center w-25" style="font-size: medium;">Overall</th>
                                <th *ngFor="let area of vulnerabilityAreas" class="text-center"
                                    style="font-size: medium;">{{area.name}}</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr *ngFor="let containerType of containerTypes" class="thead-light">
                                <th *ngIf="containerType!==containerTypeEnum.IT"
                                    class="text-left">{{containerType | replace:'_':' ' | titlecase}}</th>
                                <th *ngIf="containerType===containerTypeEnum.IT"
                                    class="text-left">{{containerType | replace:'_':' '}}</th>
                                <td class="text-center">
                                    {{data.get(-1).get(containerType) * LCV | number : '1.1-2'}}
                                </td>
                                <td *ngFor="let area of vulnerabilityAreas"
                                    class="text-center">
                                    <div class="row">
                                        <div class="col-md-6 text-right">
                                            {{data.get(area.id).get(containerType)}}
                                        </div>
                                        <div class="col-md-6 text-left">
                                            <i class="fas fa-info-circle pointer"
                                               style="color: #4FBDE9;"
                                               matTooltip="Details"
                                               [matTooltipPosition]="'above'"
                                               [routerLink]="['/evaluate-weakness/questionnaires/SELFASSESSMENT/questionnaire/container/' + containerType + '/area/' + area.id]"></i>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr class="thead-light">
                                <th class="text-center align-middle">Vulnerability</th>
                                <!--Note that the Intangible container is used to store the total vulnerability % of each area-->
                                <td class="text-center align-middle">
                                    <mat-progress-spinner
                                        *ngIf="data.has(-1) && data.get(-1).has(containerTypeEnum.INTANGIBLE)"
                                        [diameter]="50" style="margin: 0 auto;"
                                        [ngClass]="{
                                              'low': data.get(-1).get(containerTypeEnum.INTANGIBLE) > 0 && data.get(-1).get(containerTypeEnum.INTANGIBLE) <= 0.2,
                                              'low-medium': data.get(-1).get(containerTypeEnum.INTANGIBLE) > 0.2 && data.get(-1).get(containerTypeEnum.INTANGIBLE) <= 0.4,
                                              'medium': data.get(-1).get(containerTypeEnum.INTANGIBLE) > 0.4 && data.get(-1).get(containerTypeEnum.INTANGIBLE) <= 0.6,
                                              'medium-high': data.get(-1).get(containerTypeEnum.INTANGIBLE) > 0.6 && data.get(-1).get(containerTypeEnum.INTANGIBLE) <= 0.8,
                                              'high': data.get(-1).get(containerTypeEnum.INTANGIBLE) > 0.8 && data.get(-1).get(containerTypeEnum.INTANGIBLE) <= 1
                                              }"
                                        [value]="data.get(-1).get(containerTypeEnum.INTANGIBLE) * 100"
                                        matTooltip="Overall Vulnerability"
                                        [matTooltipPosition]="'above'"
                                    >
                                    </mat-progress-spinner>
                                    <div *ngIf="data.has(-1) && data.get(-1).has(containerTypeEnum.INTANGIBLE)"
                                         style="top:-35px; z-index:2;position:relative;">
                                        {{data.get(-1).get(containerTypeEnum.INTANGIBLE) | percent}}
                                    </div>
                                </td>
                                <td *ngFor="let area of vulnerabilityAreas"
                                    class="text-center align-middle">
                                    <mat-progress-spinner
                                        *ngIf="data.has(area.id) && data.get(area.id).has(containerTypeEnum.INTANGIBLE)"
                                        [diameter]="50" style="margin: 0 auto;"
                                        class="pointer"
                                        [ngClass]="{
                                              'low': data.get(area.id).get(containerTypeEnum.INTANGIBLE) > 0 && data.get(area.id).get(containerTypeEnum.INTANGIBLE) <= 0.2,
                                              'low-medium': data.get(area.id).get(containerTypeEnum.INTANGIBLE) > 0.2 && data.get(area.id).get(containerTypeEnum.INTANGIBLE) <= 0.4,
                                              'medium': data.get(area.id).get(containerTypeEnum.INTANGIBLE) > 0.4 && data.get(area.id).get(containerTypeEnum.INTANGIBLE) <= 0.6,
                                              'medium-high': data.get(area.id).get(containerTypeEnum.INTANGIBLE) > 0.6 && data.get(area.id).get(containerTypeEnum.INTANGIBLE) <= 0.8,
                                              'high': data.get(area.id).get(containerTypeEnum.INTANGIBLE) > 0.8 && data.get(area.id).get(containerTypeEnum.INTANGIBLE) <= 1
                                              }"
                                        [value]="data.get(area.id).get(containerTypeEnum.INTANGIBLE) * 100"
                                        matTooltip="Total Vulnerability"
                                        [matTooltipPosition]="'above'"
                                        [routerLink]="['/evaluate-weakness/questionnaires/SELFASSESSMENT/questionnaire/container/' + containerTypeEnum.HUMAN + '/area/' + area.id]"
                                    >
                                    </mat-progress-spinner>
                                    <div
                                        *ngIf="data.has(area.id) && data.get(area.id).has(containerTypeEnum.INTANGIBLE)"
                                        style="top:-35px; z-index:2;position:relative;">
                                        {{data.get(area.id).get(containerTypeEnum.INTANGIBLE) | percent}}
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>
</ng-container>
