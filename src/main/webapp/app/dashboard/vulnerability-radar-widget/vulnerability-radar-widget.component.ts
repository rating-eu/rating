import {Component, OnDestroy, OnInit} from '@angular/core';
import {ChartDataSets, ChartType, RadialChartOptions} from 'chart.js';
import {DataSharingService} from '../../data-sharing/data-sharing.service';
import {Subscription} from "rxjs";
import {QuestionnaireStatusMgm} from "../../entities/questionnaire-status-mgm";


@Component({
    selector: 'jhi-vulnerability-radar-widget',
    templateUrl: './vulnerability-radar-widget.component.html',
    styles: []
})
export class VulnerabilityRadarWidgetComponent implements OnInit, OnDestroy {

    private subscriptions: Subscription[];
    public isCollapsed = true;
    public vulnerabilityAssessment: QuestionnaireStatusMgm;

    constructor(private dataSharingService: DataSharingService) {
    }

    ngOnInit() {
        this.subscriptions = [];

        this.vulnerabilityAssessment = this.dataSharingService.vulnerabilityAssessment;

        this.subscriptions.push(
            this.dataSharingService.vulnerabilityAssessment$.subscribe(
                (assessment: QuestionnaireStatusMgm) => {
                    this.vulnerabilityAssessment = assessment;
                }
            )
        );
    }

    // Radar
    public radarChartOptions: RadialChartOptions = {
        responsive: true,
    };
    public radarChartLabels: String[] = ['Human', 'IT', 'Physical'];

    public radarChartData: ChartDataSets[] = [
        {data: [55, 39, 60], label: 'Initial Vulnerability'},
        {data: [65, 59, 65], label: 'Contextual Vulnerability'},
        {data: [48, 65, 70], label: 'Refined Vulnerability'}
    ];
    public radarChartType: ChartType = 'radar';

    ngOnDestroy(): void {
        if (this.subscriptions && this.subscriptions.length) {
            this.subscriptions.forEach((subscription: Subscription) => {
                if (subscription) {
                    subscription.unsubscribe();
                }
            });
        }
    }
}
